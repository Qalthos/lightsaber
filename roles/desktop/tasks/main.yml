---
- name: Install X on Arch
  package:
      name: xorg-xinit,xorg-xmodmap,lightdm-gtk-greeter,otf-fira-mono
      state: installed
  become: yes
  when: ansible_os_family == 'Archlinux'

- name: Install X on Red Hat
  package:
      name: lightdm-gtk,mozilla-fira-mono-fonts
      state: installed
  become: yes
  when: ansible_os_family == 'RedHat'

- name: Install common X
  package: xterm,accountsservice
  become: yes

- name: Install copr repos
  yum_repository:
      name: "{{ item.owner }}-{{ item.repo }}"
      description: Copr repo for {{ item.repo }} owned by {{ item.owner }}
      baseurl: https://copr-be.cloud.fedoraproject.org/results/{{ item.owner }}/{{ item.repo }}/fedora-$releasever-$basearch/
      gpgkey: https://copr-be.cloud.fedoraproject.org/results/{{ item.owner }}/{{ item.repo }}/pubkey.gpg
      gpgcheck: yes
      file: _copr_{{ item.owner }}-{{ item.repo }}
  become: yes
  loop:
    - {owner: yaroslav, repo: i3desktop}
    - {owner: numix, repo: numix}
    - {owner: notkild, repo: pamixer}
    - {owner: dirkdavidis, repo: papirus-icon-theme}
  when: ansible_distribution == 'Fedora'

- name: Set up user avatar
  copy:
      src: "{{ item.src }}"
      dest: "{{ item.dest }}"
  become: yes
  loop:
      - { src: avatar.png, dest: /var/lib/AccountsService/icons/nate }
      - { src: user_file, dest: /var/lib/AccountsService/users/nate }

- name: Install desktop applications & themes
  package:
      name: herbstluftwm,compton,dzen2,rofi,conky,nitrogen,qterminal,thunar,dunst,numix-gtk-theme,papirus-icon-theme
      state: installed
  become: yes

- name: Copy base dotfiles
  copy:
      src: "{{ item }}"
      dest: "~/.{{ item }}"
  loop:
      - gtkrc-2.0
      - stalonetrayrc
      - xmodmap
      - xscreensaver

- name: Create .config directory tree
  file:
      path: ~/.config/{{ item.path }}
      state: directory
  loop: "{{ query('filetree', 'config/' }}"
  when: item.state == 'directory'

- name: Copy .config directory
  copy:
      src: config/{{ item.path }}
      dest: ~/.config/{{ item.path }}
  loop: "{{ query('filetree', 'config/' }}"
  when: item.state == 'file'

- name: Dzen conkyrc template
  template:
      src: conkyrc.j2
      dest: ~/.config/herbstluftwm/conkyrc

- name: Copy helper scripts
  copy:
      src: "{{ item }}"
      dest: ~/bin/
  loop: "{{ query('fileglob', 'bin/*') }}"

- name: Make sure xf86-video-odroid-c1 is not present
  become: yes
  package:
      name: xf86-video-odroid-c1
      state: absent
  when: ansible_machine[:3] == 'arm'
